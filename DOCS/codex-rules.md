# Codex Collaboration Rules for Flow Control

למסמך זה יש מקום של קבצים והנחיות שנכתבו בזמן העבודה עם Codex; הוא מגדיר את הכללים המרכזיים שאנו מקפידים עליהם בפרויקט:

## 1. סדרי עבודה
- תשאיר את `DOCS/backend-work-plan.md` מעודכן בכל שינוי משמעותי ב‑scope. הפניה תמיד תכיל נתונים: מי ביקש, איפה, מה השינוי.
- בגישה לכל קובץ או ממשק תתבסס קודם על המסמכים המעודכנים (`DOCS/התכתבות Flow Control  10.11.25.txt` הוא המקור הסופי), ואז על `DOCS/DOS from APP/` אם צריך פירוט טכני לבניית מסכים.
- בכל עת שאתה מבקש חוות דעת או אישור, ציין בדיוק כיצד הכנת את המידע (למשל טבלת ישויות, `ERD`, `CVS` מפוענח) כדי שאוכל לבדוק במהירות.

## 2. בניית שרת ו‑API
- הסכמה למסד נתונים מבוססת על `CSV` ואפיון המסכים; כל שדה חייב לקבל תיאור ולינק לקובץ מקור לפני הוספה ל־`Prisma`.
- בכל endpoint חדש תיצר תיעוד קצר (2–3 משפטים) שמסביר את הכניסות/יציאות, סטטוסים ותלותות (לדוגמה “עדכון משיכה שומר גם לוג ואז מעדכן מלאי”).
- בכל LOB חשוב (Inventory, Shipments, Orders) יש לבדוק שהלוגיקה תגיב להשלכות רוחביות – כל שינוי בשדה “כמות” או “סטטוס” מפעיל job / notification שמעדכן רשומות תלויות.

## 3. ממשק מול הפרונט
- כל API צריך להחזיר מבנה מידע שפורסם באחד המקורות (`DOCS/DOS from APP/Pages`), כדי להבטיח שהפיצ’רים עומדים בציפייה של הקומפוננטות.
- במקום להתאים קומפוננטות ל־Base44 SDK, נבנה abstraction חדש (`src/api/restClient.js` ולפחות one-layer) שמחליף את `base44.functions.*`.
- Document endpoints חשובים בדשבורד (`dashboard data`, `alerts`, `inventory count`, `shipments`) עם דוגמת JSON כדי שאפשר לפתוח שוב בזמן מהיר.

## 4. תפעול ואיכות
- לפני הרצת DB migrations – תמיד תבדוק שאין נתונים חיוניים שלא גובו; תעדכן `DOCS/backup-notes.md` אם צריך.
- פיתוח אפשרי בשתי סביבות: לעולם לא תריץ צעדים destructive (drop tables, `prisma migrate reset`, `git reset --hard`) בלי אישור גדול בכתב.
- כאשר יש שינויים impacting security (ROL, auth), הוסף `NOTE` בגיט (commit message) ובמסמך `DOCS/backend-work-plan.md` עם תיאור השינוי.

## 5. תקשורת עם Codex
- כדי “לסמן” קובץ פשוט ציין את הנתיב המלא (לדוגמה `DOCS/Reagent_2025-10-30.csv`) בהודעה; אם נדרש אז ציין גם טווח שורות ספציפי.
- אם יש “כללים מיוחדים” לכתיבה, תעד בקובץ זה או `DOCS/codex-rules.md` כדי שאזכור לפיהם.
- בקשות לפעולות טכניות תחולקנה לשלבים: “הכן את הסכמה” → “בדוק” → “הרץ תסריט”. כלומר תן למערכת להתקדם שלב-שלב.

עודכן ב־`DOCS/codex-rules.md` כדי שאוכל לחזור עליהם בכל פעם שאנחנו פותחים את הפרויקט. אם תרצה לשנות אותם, פשוט עדכן את הקובץ ואנחנו נמשיך מהעדכון האחרון.*** End Patch**#
